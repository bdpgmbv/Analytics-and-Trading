replicaCount: 2

image:
  repository: my-registry/positionloader
  tag: "2.0.0"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8080

resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# ═══════════════════════════════════════════════════════════════════════════════
# ENVIRONMENT VARIABLES - All Phases
# ═══════════════════════════════════════════════════════════════════════════════
env:
  # Core
  SPRING_PROFILES_ACTIVE: prod

  # Database
  DB_HOST: prod-db
  DB_PORT: "5432"
  DB_NAME: fxan
  DB_USER: positionloader_app
  # DB_PASS: from secret

  # Kafka
  KAFKA_SERVERS: kafka:9092

  # Upstream
  MSPM_URL: http://mspm-service:8080

  # ═══════════════════════════════════════════════════════════════════════════
  # Phase 1: Core Settings
  # ═══════════════════════════════════════════════════════════════════════════
  EOD_THREADS: "16"
  BATCH_SIZE: "1000"
  MAX_UPLOAD: "10000"
  DLQ_MAX_RETRIES: "3"
  DLQ_INTERVAL: "300000"

  # Phase 1: Validation
  VALIDATION_ENABLED: "true"
  REJECT_ZERO_QTY: "true"
  MAX_PRICE: "1000000"

  # ═══════════════════════════════════════════════════════════════════════════
  # Phase 2: Reliability
  # ═══════════════════════════════════════════════════════════════════════════
  MAX_CONCURRENT: "40"
  DLQ_ALERT_THRESHOLD: "50"

  # ═══════════════════════════════════════════════════════════════════════════
  # Phase 3: Observability
  # ═══════════════════════════════════════════════════════════════════════════
  TRACING_ENABLED: "true"
  TRACING_SAMPLE_RATE: "0.1"  # 10% sampling in prod
  OTLP_ENDPOINT: http://otel-collector:4318/v1/traces
  LAG_ALERT_THRESHOLD: "1000"
  LOG_LEVEL: INFO

  # ═══════════════════════════════════════════════════════════════════════════
  # Phase 4: Feature Flags
  # ═══════════════════════════════════════════════════════════════════════════
  EOD_ENABLED: "true"
  INTRADAY_ENABLED: "true"
  DUPLICATE_DETECTION: "true"
  RECONCILIATION_ENABLED: "true"
  DISABLED_ACCOUNTS: ""      # Comma-separated account IDs to skip
  PILOT_ACCOUNTS: ""         # If set, only process these

  # Phase 4: Archival
  ARCHIVAL_ENABLED: "true"
  RETENTION_DAYS: "365"      # 1 year in prod
  ARCHIVAL_CRON: "0 0 2 * * SUN"

# ═══════════════════════════════════════════════════════════════════════════════
# SECRETS (reference from K8s secrets)
# ═══════════════════════════════════════════════════════════════════════════════
envFrom:
  - secretRef:
      name: positionloader-secrets

# ═══════════════════════════════════════════════════════════════════════════════
# HEALTH PROBES
# ═══════════════════════════════════════════════════════════════════════════════
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
  failureThreshold: 3

# ═══════════════════════════════════════════════════════════════════════════════
# GRACEFUL SHUTDOWN
# ═══════════════════════════════════════════════════════════════════════════════
terminationGracePeriodSeconds: 45  # Allow 30s for jobs + 15s buffer

# ═══════════════════════════════════════════════════════════════════════════════
# POD DISRUPTION BUDGET
# ═══════════════════════════════════════════════════════════════════════════════
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# ═══════════════════════════════════════════════════════════════════════════════
# PROMETHEUS METRICS
# ═══════════════════════════════════════════════════════════════════════════════
serviceMonitor:
  enabled: true
  interval: 30s
  path: /actuator/prometheus

# ═══════════════════════════════════════════════════════════════════════════════
# AUTOSCALING (for high-volume days)
# ═══════════════════════════════════════════════════════════════════════════════
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 6
  targetCPUUtilizationPercentage: 70