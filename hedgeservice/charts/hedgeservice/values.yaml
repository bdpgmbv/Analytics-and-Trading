# Hedge Service - Kubernetes Deployment Values
# Handles FX hedging operations via FIX protocol

replicaCount: 2

image:
  repository: my-registry/hedgeservice
  tag: "1.0.0"
  pullPolicy: IfNotPresent

# Service exposes both HTTP (8080) and FIX (9898) ports
service:
  type: ClusterIP
  httpPort: 8080
  fixPort: 9898

# Ingress for external access
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
  hosts:
    - host: hedge.fxanalyzer.internal
      paths:
        - path: /
          pathType: Prefix

# Resource allocation - FIX engine requires stable resources
resources:
  requests:
    memory: "1Gi"
    cpu: "1000m"
  limits:
    memory: "2Gi"
    cpu: "2000m"

# Environment variables
env:
  SPRING_PROFILES_ACTIVE: "prod"
  SPRING_DATASOURCE_URL: "jdbc:postgresql://postgres.data-ns.svc.cluster.local:5432/analyticsandtrading"
  SPRING_DATA_REDIS_HOST: "redis-master.data-ns.svc.cluster.local"
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "kafka.data-ns.svc.cluster.local:9092"
  # FIX Configuration
  FIX_SENDER_COMP_ID: "FX_ANALYZER"
  FIX_TARGET_COMP_ID: "FX_MATRIX"

# Secrets (referenced from Kubernetes secrets)
envFrom:
  - secretRef:
      name: hedgeservice-secrets

# Health checks
livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  failureThreshold: 3

# Pod disruption budget - keep at least 1 replica during updates
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Volume mounts for FIX logs (audit trail requirement)
persistence:
  enabled: true
  storageClass: "standard"
  accessMode: ReadWriteOnce
  size: 10Gi
  mountPath: /target/data/quickfix/log

# Node affinity - prefer nodes with low latency to FX Matrix
nodeSelector:
  trading-zone: "low-latency"

# Tolerations for dedicated trading nodes
tolerations:
  - key: "trading"
    operator: "Equal"
    value: "true"
    effect: "NoSchedule"

# Service account
serviceAccount:
  create: true
  name: hedgeservice-sa
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT:role/hedgeservice-role

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Pod annotations for Prometheus scraping
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/actuator/prometheus"
