groups:
  - name: trading-platform-alerts
    rules:
      # 1. Critical Alert: Dead Letter Queue is filling up
      # This means trades are failing and being set aside. Immediate action required.
      - alert: DeadLetterQueueNotEmpty
        expr: kafka_dlq_depth > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Critical: Kafka DLQ Buildup"
          description: "Kafka DLQ depth is {{ $value }}. This indicates unprocessable trades. Check logs immediately."

      # 2. Warning: Upstream Connectivity Lost
      # If the Circuit Breaker to the Mainframe (MSPM) is OPEN, we can't load positions.
      - alert: UpstreamMspmDown
        expr: resilience4j_circuitbreaker_state{name="mspm-service", state="open"} == 1
        for: 10s
        labels:
          severity: warning
        annotations:
          summary: "Circuit Breaker Open: MSPM"
          description: "Connection to upstream MSPM is broken. EOD loads will fail."

      # 3. Performance Warning: Pricing is too slow
      # If valuation takes > 500ms, the UI will feel laggy.
      - alert: ValuationLatencyHigh
        expr: rate(valuation_batch_processing_seconds_sum[1m]) / rate(valuation_batch_processing_seconds_count[1m]) > 0.5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High Valuation Latency"
          description: "Pricing batch processing is averaging > 500ms."